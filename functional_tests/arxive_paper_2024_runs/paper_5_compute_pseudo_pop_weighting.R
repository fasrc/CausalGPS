##      author:  Naeem Khoshnevis
##      created: March 2024 (Updated: September 2024)
##      purpose: Reproducing examples in the paper.


# Load libraries
library(ggplot2)
library(CausalGPS)


# Load cw object and data
load("cw_weighting_object.RData")
load("study_data.RData")

confounders   <- c("mean_bmi", "smoke_rate",
                   "hispanic", "pct_blk", "medhouseholdincome",
                   "medianhousevalue", "poverty", "popdensity",
                   "pct_owner_occ", "summer_tmmx", "winter_tmmx",
                   "summer_rmax", "winter_rmax", "year")


pseudo_pop_weighting_object <- generate_pseudo_pop(
                                           .data = data,
                                           cw_obj = cw_weighting_object,
                                           covariate_col_names = confounders,
                                           covar_bl_trs = 0.1,
                                           covar_bl_trs_type = "maximal",
                                           covar_bl_method = "absolute")


save(pseudo_pop_weighting_object, file = "pseudo_pop_weighting_object.RData")


pdf("figure_paper_5_pseudo_pop_weighting_object.pdf")
plot(pseudo_pop_weighting_object)
dev.off()
