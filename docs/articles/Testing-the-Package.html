<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Testing the Package • CausalGPS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Testing the Package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CausalGPS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/CausalGPS.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/Estimating-GPS.html">Estimating GPS</a></li>
    <li><a class="dropdown-item" href="../articles/Generating-Pseudo-Population.html">Generating Pseudo Population</a></li>
    <li><a class="dropdown-item" href="../articles/Outcome-Models.html">Outcome Models</a></li>
    <li><a class="dropdown-item" href="../articles/Generating-Synthetic-Data.html">Generate Synthetic Data</a></li>
    <li><a class="dropdown-item" href="../articles/Frequently-Asked-Questions.html">Frequently Asked Questions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Collabration</h6></li>
    <li><a class="dropdown-item" href="../articles/Developers-Guide.html">Developers Guide</a></li>
    <li><a class="dropdown-item" href="../articles/Testing-the-Package.html">Testing the Package</a></li>
    <li><a class="dropdown-item" href="../articles/Notes-on-SL-Wrapper.html">Notes on SL Wrappers</a></li>
    <li><a class="dropdown-item" href="../articles/Singularity-Image.html">Singularity</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NSAPH-Software/CausalGPS/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Testing the Package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NSAPH-Software/CausalGPS/blob/HEAD/vignettes/Testing-the-Package.Rmd" class="external-link"><code>vignettes/Testing-the-Package.Rmd</code></a></small>
      <div class="d-none name"><code>Testing-the-Package.Rmd</code></div>
    </div>

    
    
<p>Testing the package is an important part of package development.
Although we are unit-testing the functions, there is always a situation
that is not tested. Please feel free to try the code under different
conditions. Please report the bugs as a <a href="https://github.com/NSAPH-Software/CausalGPS/issues/" class="external-link">new
issue</a>. In the following, there steps to generate synthetic data and
conduct some testing.</p>
<p>In order to test the package, you need to have the code on your
system (R (&gt;= 3.5.0)). There are two options:</p>
<ul>
<li>Installing the package</li>
<li>Cloning the package</li>
<li>Forking the package</li>
</ul>
<p>If you are running the code on a cluster and trying to carry out some
test on scaling out, installing it is the best option. However, if you
want to dig deeper and debug the code interactively, cloning the code is
your choice. If you are planning to test, debug, and commit the changes,
use forking. In the following, we explain all these options.</p>
<div class="section level2">
<h2 id="getting-the-code">Getting the Code<a class="anchor" aria-label="anchor" href="#getting-the-code"></a>
</h2>
<div class="section level3">
<h3 id="installing-the-package">Installing the Package<a class="anchor" aria-label="anchor" href="#installing-the-package"></a>
</h3>
<p>Use <code><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">devtools::install_github</a></code> to install the package. If
you do not specify the <code>ref</code>, it will install the master (or
main) branch. The <code>master</code> branch hosts the latest released
code. The latest updates are committed to the <code>develop</code>
branch. For more details please refer <em>Git Branching Model</em> in
the Developers Guide section.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/detach.html" class="external-link">detach</a></span><span class="op">(</span><span class="st">"package:CausalGPS"</span>, unload <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># if already you have the package, detach and unload it, to have a new install. </span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"NSAPH-Software/CausalGPS"</span>, ref<span class="op">=</span><span class="st">"develop"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NSAPH-Software/CausalGPS" class="external-link">CausalGPS</a></span><span class="op">)</span></span></code></pre></div>
<p>The process should run smoothly. Try <code><a href="../reference/CausalGPS-package.html">?CausalGPS</a></code>. It
should open the package description page under the help tab (assuming
you are using RStudio).</p>
</div>
<div class="section level3">
<h3 id="cloning-the-package">Cloning the Package<a class="anchor" aria-label="anchor" href="#cloning-the-package"></a>
</h3>
<p>Go to the package <a href="https://github.com/NSAPH-Software/CausalGPS/" class="external-link">Github
repository</a>, at the top left (A), choose the branch that you want to
clone, then click on the <code>Code</code> button (B), then choose
<code>Download ZIP</code>. The following figure shows the buttons’
location.</p>
<p float="center">
<img src="../reference/figures/png/testing_example_discussion_fig1.png" width="600"></p>
<p>After cloning the code, open one of the files using RStudio, then
change the project directory to the project directory
(<code>Session &gt; Set Working Directory &gt; To Project Directory</code>).</p>
</div>
<div class="section level3">
<h3 id="forking-the-package">Forking the package<a class="anchor" aria-label="anchor" href="#forking-the-package"></a>
</h3>
<p>Forking is explained in the <em>Contribution</em> page.</p>
</div>
</div>
<div class="section level2">
<h2 id="package-development-test-check-cycle">Package development, test, check cycle<a class="anchor" aria-label="anchor" href="#package-development-test-check-cycle"></a>
</h2>
<p>There are some commands that you need to use during testing and
debugging the package. You can read about these commands in <a href="https://r-pkgs.org/" class="external-link">R Packages</a> book. For debugging and
testing, you do not need to know all steps. Here is the list of commands
that you need:</p>
<ul>
<li>
<code><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">document()</a></code> if you change Roxygen Skeleton (e.g., you
added new argument to the function, or improved the example), run
<code>documents()</code>. It will make sure that your internal
documentation is updated.</li>
<li>
<code><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">test()</a></code> runs all tests that is located inside the
<code>tests/testthat</code> folder. Any modification to the code should
be followed by running <code><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">test()</a></code> to make sure that you are not
breaking existing functionality.</li>
<li>
<code><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check()</a></code> checks many other features (e.g., whether the
package can be installed without problem). You do not need to run
<code><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check()</a></code> frequently; however, we would suggest running it
once you get the code and once before committing to make sure that there
are no errors, warnings, and notes.</li>
<li>
<code><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all()</a></code> the program source code is different than
the one which is loaded on your memory (read more <a href="https://r-pkgs.org/package-structure-state.html" class="external-link">here</a>). If you
modify some part of the code, you need to load it on memory to takes the
latest modifications effect. Run <code><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all()</a></code> after
modification and before testing.</li>
<li>
<code><a href="https://devtools.r-lib.org/reference/install.html" class="external-link">install()</a></code> in most of the cases <code><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all()</a></code>
is sufficient. However, sometimes the links between package components
are broken. It especially happens when you significantly change some
part of the code, and it does not pass the tests. In such cases, you may
need to run <code><a href="https://devtools.r-lib.org/reference/install.html" class="external-link">install()</a></code>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="running-examples">Running Examples<a class="anchor" aria-label="anchor" href="#running-examples"></a>
</h2>
<p>You can use any causal inference studies data to test the package.
The database needs to have the following attributes:</p>
<ul>
<li>
<strong><code>Y</code></strong>: Output value</li>
<li>
<strong><code>w</code></strong>: Treatment</li>
<li>
<strong><code>C</code></strong>: covariate matrix</li>
</ul>
<p>The package can generate synthetic data that can be used to test
different features of the package. At the current implementation, the
code only generates synthetic numerical data; however, with small
innovation, one can add categorical data. In the following, we present
some reproducible examples that you can copy and build upon them.</p>
<div class="section level3">
<h3 id="generating-synthetic-data">Generating Synthetic Data<a class="anchor" aria-label="anchor" href="#generating-synthetic-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/NSAPH-Software/CausalGPS" class="external-link">"CausalGPS"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_syn_data.html">generate_syn_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span>
<span><span class="co">#'data.frame':  10000 obs. of  8 variables:</span></span>
<span><span class="co"># $ Y    : num  -17 3.66 -45.88 -12.12 2.75 ...</span></span>
<span><span class="co"># $ treat: num  9.74 14.88 5.22 10.19 16.65 ...</span></span>
<span><span class="co"># $ cf1  : num  -0.128 0.155 -1.271 0.551 0.846 ...</span></span>
<span><span class="co"># $ cf2  : num  0.2376 0.0466 0.8918 -1.8434 -2.4487 ...</span></span>
<span><span class="co"># $ cf3  : num  1.5492 -0.4453 0.0718 0.8309 0.6749 ...</span></span>
<span><span class="co"># $ cf4  : num  1.3738 0.8621 0.4735 0.7013 -0.0851 ...</span></span>
<span><span class="co"># $ cf5  : num  -2 2 1 -2 0 1 1 2 -2 -1 ...</span></span>
<span><span class="co"># $ cf6  : num  -1.794 -1.822 0.79 -0.591 2.673 ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimating-gps-values-for-the-dataset">Estimating GPS Values for the Dataset<a class="anchor" aria-label="anchor" href="#estimating-gps-values-for-the-dataset"></a>
</h3>
<p>In the following example, first, we generate 10000 synthetic data
samples, then we feed them into <code>estimate_gps</code> function to
estimate their GPS values. Please note that the Y variable is not used
inside the code, and it is only provided to cbind with the generated GPS
values. You can read more about different arguments in the documentation
(<code><a href="../reference/estimate_gps.html">?estimate_gps</a></code>). In summary, - We want to run a code using
SuperLearner (<code>sl</code>) prediction model. Inside the SuperLearner
package, we want to use the XGBoost package. As you know, we internally
generate a customized wrapper for the XGBoost package; thus, the correct
way to activate that is by passing <code>m_xgboost</code>, which stands
for <em>modified xgboost</em>. - We requested for one thread
(<code>nthread = 1</code>); you can use as much as you want; the package
will use the available one and will ignore the rest of them. XGBoost
uses OpenMP backend to use all cores. Sometimes it becomes a really big
challenge on Mac systems. So if you are using Mac and do not see any
performance improvement, be aware of that. - In <code>params</code>, we
passed the list of parameters; the function will choose one from each
list at random and will generate a customize wrapper based on them. If
you want to use a specific value, just give a list one number (e.g.,
xgb_max_depth = c(3)). All parameters that start with <code>xgb_</code>
will only change XGBoost hyperparameters.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"CausalGPS"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">generate_syn_data</span>(<span class="at">sample_size =</span> <span class="dv">10000</span>) </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>data_with_gps <span class="ot">&lt;-</span> <span class="fu">estimate_gps</span>(mydata[, <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"Y"</span>)],</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>                              mydata[, <span class="fu">c</span>(<span class="st">"id"</span>, w<span class="st">")],</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="st">                              mydata[, c("</span>id<span class="st">", "</span>cf1<span class="st">", "</span>cf2<span class="st">", "</span>cf3<span class="st">", </span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="st">                                         "</span>cf4<span class="st">","</span>cf5<span class="st">","</span>cf6<span class="st">")],</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="st">                              params = list(xgb_max_depth = c(3,4,5),</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="st">                                       xgb_nrounds=c(10,20,30,40,50,60)),</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="st">                              nthread = 1,</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="st">                              sl_lib = c("</span>m_xgboost<span class="st">")</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="st">                             )</span></span></code></pre></div>
<p>Now, let’s add some categorical data. Let’s say our data belongs to 5
different years (2000 observations per year), and each year we have data
from 4 different regions, including <em>North</em>, <em>South</em>,
<em>East</em>, and <em>West</em>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/NSAPH-Software/CausalGPS" class="external-link">"CausalGPS"</a></span><span class="op">)</span></span>
<span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_syn_data.html">generate_syn_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2001"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2002"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2003"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2004"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>, </span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2005"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"North"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"South"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"East"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"West"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mydata</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">mydata</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_with_gps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_gps.html">estimate_gps</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                              <span class="va">mydata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"w"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                              <span class="va">mydata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"cf1"</span>, <span class="st">"cf2"</span>, <span class="st">"cf3"</span>, <span class="st">"cf4"</span>,</span>
<span>                                         <span class="st">"cf5"</span>, <span class="st">"cf6"</span>, <span class="st">"year"</span>, <span class="st">"region"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                              params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xgb_max_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>                                       xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                              nthread <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                              sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span></span>
<span>                             <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generating-pseudo-population">Generating Pseudo Population<a class="anchor" aria-label="anchor" href="#generating-pseudo-population"></a>
</h3>
<p>Generating pseudo population (<code>gen_pseudo_pop()</code>)is one of
the important parts of the package. It internally uses
<code><a href="../reference/estimate_gps.html">estimate_gps()</a></code> package. An acceptable pseudo population
should pass the covariate balance test. Users choose which test and what
threshold, and how many attempts. If the covariate balance test is met,
the function stops trying and returns the generated population. However,
if it cannot pass the test, it still returns what is generated with a
message to the user indicating the population did not pass the test. At
each iteration, we change the hyperparameters to modify GPS values (to
better or worse) to pass the covariate balance test. After estimating
the GPS values, we need to compile the population. There are three major
approaches to compile pseudo population, including:</p>
<ul>
<li>Matching</li>
<li>Adjusting (not implemented)</li>
<li>Weighting (not implemented)</li>
</ul>
<p>Among different methods for testing covariate balance test, only
<code>absolute</code> approach is implemented.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/NSAPH-Software/CausalGPS" class="external-link">"CausalGPS"</a></span><span class="op">)</span></span>
<span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_syn_data.html">generate_syn_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> </span>
<span><span class="va">pseudo_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pseudo_pop.html">generate_pseudo_pop</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                  <span class="va">mydata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"w"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                  <span class="va">mydata</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"cf1"</span>, <span class="st">"cf2"</span>, </span>
<span>                                            <span class="st">"cf3"</span>, <span class="st">"cf4"</span>, <span class="st">"cf5"</span>, <span class="st">"cf6"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                  ci_appr <span class="op">=</span> <span class="st">"matching"</span>,</span>
<span>                                  sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>,</span>
<span>                                  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span><span class="op">)</span>,</span>
<span>                                  xgb_eta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  nthread <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  covar_bl_method <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>                                  covar_bl_trs <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                  covar_bl_trs_type<span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                                  max_attempt <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  dist_measure <span class="op">=</span> <span class="st">"matching_fn"</span>,</span>
<span>                                  delta_n <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  scale <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>The second causal inference approach is <code>weighting</code>. Here
is an example to generate pseudo population using <code>weighting</code>
approach.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_syn_data.html">generate_syn_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2001"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2002"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2003"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2004"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>, </span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2005"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"North"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"South"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"East"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"West"</span>,each<span class="op">=</span><span class="fl">500</span><span class="op">)</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mydata</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">mydata</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pseudo_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pseudo_pop.html">generate_pseudo_pop</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                  <span class="va">mydata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"w"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                  <span class="va">mydata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"cf1"</span>, <span class="st">"cf2"</span>, <span class="st">"cf3"</span>, </span>
<span>                                             <span class="st">"cf4"</span>,<span class="st">"cf5"</span>,<span class="st">"cf6"</span>, </span>
<span>                                             <span class="st">"year"</span>,<span class="st">"region"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                  ci_appr <span class="op">=</span> <span class="st">"weighting"</span>,</span>
<span>                                  sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>,</span>
<span>                                  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span><span class="op">)</span>,</span>
<span>                                   xgb_eta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  nthread <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  covar_bl_method <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>                                  covar_bl_trs <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                  covar_bl_trs_type <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                                  max_attempt <span class="op">=</span> <span class="fl">1</span></span>
<span>                                  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="further-processing">Further Processing<a class="anchor" aria-label="anchor" href="#further-processing"></a>
</h3>
<p>After generating a pseudo population, we can process the data for
different purposes. So far, estimating exposure rate function
(<code>estimate_erf</code>) is implemented.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library("CausalGPS")</span></span>
<span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_syn_data.html">generate_syn_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> </span>
<span><span class="va">pseudo_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_pseudo_pop.html">generate_pseudo_pop</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                  <span class="va">mydata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"w"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                  <span class="va">mydata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"cf1"</span>,<span class="st">"cf2"</span>,<span class="st">"cf3"</span>,<span class="st">"cf4"</span>,<span class="st">"cf5"</span>,<span class="st">"cf6"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                  ci_appr <span class="op">=</span> <span class="st">"matching"</span>,</span>
<span>                                  sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m_xgboost"</span><span class="op">)</span>,</span>
<span>                                  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xgb_nrounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span><span class="op">)</span>,</span>
<span>                                   xgb_eta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  nthread <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  covar_bl_method <span class="op">=</span> <span class="st">"absolute"</span>,</span>
<span>                                  covar_bl_trs <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                  covar_bl_trs_type<span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                                  max_attempt <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  dist_measure <span class="op">=</span> <span class="st">"l1"</span>,</span>
<span>                                  delta_n <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  scale <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">erf_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_npmetric_erf.html">estimate_npmetric_erf</a></span><span class="op">(</span><span class="va">pseudo_pop</span><span class="op">$</span><span class="va">pseudo_pop</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>                                 <span class="va">pseudo_pop</span><span class="op">$</span><span class="va">pseudo_pop</span><span class="op">$</span><span class="va">w</span>,</span>
<span>                                 bw_seq<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">2</span>,<span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                                 w_vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">20</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="steps-for-using-precomputed-data-during-the-test">Steps for using precomputed data during the test<a class="anchor" aria-label="anchor" href="#steps-for-using-precomputed-data-during-the-test"></a>
</h2>
<p>The package is being tested on different data samples, some of them
are generated during testing, and some others are generated before and
just are loaded. These data are located in “R/sysdata.rda” file. If you
add new features to the code, you may need to use some external or
pre-computed data set to test your functions. In the following, we
explain the steps to append data to “R/sysdata.rda”. Please note that
CRAN might reject large data sets.</p>
<ul>
<li><p>Step 1: Run <code><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check()</a></code> to make sure that the file as-is
satisfies all test requirements. If it raises an error, warning, or
note, please address them before modifying the data. In some rare cases,
<code><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check()</a></code> does not pass successfully, however, test() does.
This is sufficient for changing the data; however, you need to address
it before submitting a pull request.</p></li>
<li><p>Step 2: Create a backup data from the current data.</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode s"><code class="sourceCode gnuassembler"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># in terminal</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>cp  R<span class="op">/</span>sysdata.rda R<span class="op">/</span>sysdata_backup.rda</span></code></pre></div>
<ul>
<li>Step 3: Clean Global environment</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Step 4: Load current data and store the names</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"R/sysdata.rd"</span><span class="op">)</span></span>
<span><span class="va">list_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Step 5: Generate your data (mydata) and make sure to add steps to
reproduce that data as a comment in your test file.</li>
<li>Step 6: Add new data name to <code>list_names</code>. Please note
the quotes. You do not need to add data, just the name.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">list_names</span>, <span class="st">"mydata"</span><span class="op">)</span> </span></code></pre></div>
<ul>
<li>Step 7: Save the data.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span>list<span class="op">=</span><span class="va">list_names</span>, file<span class="op">=</span><span class="st">"R/sysdata.rda"</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Step 8: Run <code>check()/test()</code> to make sure that it passes
all tests. If it does not pass all tests, address the problem.</li>
<li>Step 9: After successful <code>check()/pass()</code> remove the
backup file.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Naeem Khoshnevis, Xiao Wu, Danielle Braun.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
